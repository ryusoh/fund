name: Sync labels
on:
    workflow_dispatch:
    push:
        paths:
            - .github/workflows/sync-labels.yml

jobs:
    sync:
        runs-on: ubuntu-latest
        permissions:
            issues: write
            contents: read
        steps:
            - uses: actions/checkout@v4
            - uses: actions/github-script@v7
              with:
                  script: |
                      const labels = [
                        { name: 'dependencies', color: '0366d6', description: 'Dependency update PRs' },
                        { name: 'npm',          color: '0e8a16', description: 'JavaScript dependency updates' },
                        { name: 'ci',           color: '5319e7', description: 'Continuous Integration' },
                        { name: 'automerge',    color: '0e8a16', description: 'Automatically enable auto-merge when present' },
                      ];
                      for (const l of labels) {
                        try {
                          await github.rest.issues.updateLabel({
                            owner: context.repo.owner,
                            repo: context.repo.repo,
                            name: l.name,
                            new_name: l.name,
                            color: l.color,
                            description: l.description ?? ''
                          });
                        } catch (e) {
                          if (e.status === 404) {
                            await github.rest.issues.createLabel({
                              owner: context.repo.owner,
                              repo: context.repo.repo,
                              name: l.name,
                              color: l.color,
                              description: l.description ?? ''
                            });
                          } else {
                            throw e;
                          }
                        }
                      }
