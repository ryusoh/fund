name: Update Fund Data

on:
    schedule:
        - cron: '*/30 * * * 1-5' # Runs every 30 minutes on weekdays
    workflow_dispatch:

concurrency:
    group: ${{ github.workflow }}
    cancel-in-progress: true

permissions:
    contents: write

jobs:
    update:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v6

            - name: Set up Python
              uses: actions/setup-python@v6
              with:
                  python-version: '3.x'

            - name: Install dependencies
              run: pip install -r requirements.txt

            - name: Run update script
              env:
                  POLYGON_KEY: ${{ secrets.POLYGON_KEY }}
              run: python scripts/data/update_fund_data.py

            - name: Commit and push changes
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"
                  git add data/fund_data.json
                  git commit -m "chore(data): ファンドデータを自動更新 [skip ci]" || echo "No changes to commit"
                  git push
